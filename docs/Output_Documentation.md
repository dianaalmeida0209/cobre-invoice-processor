# üìä Processed Output Samples - Cobre Invoice Processing System

## Overview

This document explains the structured output format generated by our AI-powered invoice processing system. All examples are from real processing runs on sample invoice data, demonstrating the system's capability to handle diverse invoice formats and business scenarios.

---

## üéØ Sample Output Structure

Each processed invoice generates a comprehensive JSON output with the following sections:

### **Core Identification**
```json
{
  "invoice_id": 1,
  "content_hash": "6a7958b4b78a6fe980a0a4c6e3f76d95",
  "processing_timestamp": "2025-09-17T21:30:01.702452",
  "processing_time_seconds": 3.029
}
```

### **Document Metadata & Risk Score**
```json
{
  "document_metadata": {
    "type": "formal_invoice",      // formal_invoice, email, json, credit_note
    "language": "spanish",         // spanish, english, portuguese, unknown
    "processing_status": "routed", // completed, failed, validation_failed
    "risk_score": 0.02            // 0.0 (low) to 1.0 (high risk)
  }
}
```

### **Extracted Business Data**
```json
{
  "extracted_data": {
    "numero_factura": "F-2025-001",           // Invoice number
    "proveedor": "TechSolutions M√©xico S.A.",  // Vendor name  
    "monto_total": 45220000,                   // Amount in original currency
    "moneda": "COP",                          // COP, USD, EUR
    "fecha": "2025-09-15"                     // Date (YYYY-MM-DD)
  }
}
```

---

## üìã Processing Outcome Examples

### **‚úÖ Successful Auto-Approval**
**Scenario**: Small formal invoice, all fields complete, low risk
```json
{
  "invoice_id": 39,
  "document_metadata": {
    "type": "formal_invoice",
    "risk_score": 0.02
  },
  "extracted_data": {
    "numero_factura": "F-2025-890",
    "proveedor": "Servicios P√∫blicos Empresariales", 
    "monto_total": 6307000,
    "moneda": "COP"
  },
  "approval": {
    "decision": "auto_approved",
    "requires_human_review": false,
    "risk_level": "low"
  },
  "integration_ready": {
    "payment_system": true,    // ‚úÖ Ready for automated payment
    "erp_system": true,
    "compliance_check": true
  }
}
```

### **‚ö†Ô∏è Supervisor Review Required**
**Scenario**: Medium amount, valid data, standard business flow
```json
{
  "invoice_id": 1,
  "document_metadata": {
    "type": "formal_invoice",
    "risk_score": 0.02
  },
  "extracted_data": {
    "numero_factura": "F-2025-001",
    "proveedor": "TechSolutions M√©xico S.A. de C.V.",
    "monto_total": 45220000,
    "moneda": "COP"
  },
  "approval": {
    "decision": "supervisor_review",
    "requires_human_review": true,
    "risk_level": "low"
  }
}
```

### **üè¢ Manager Review - High Amount**
**Scenario**: Large invoice requiring management approval
```json
{
  "invoice_id": 11,
  "document_metadata": {
    "type": "formal_invoice", 
    "risk_score": 0.04
  },
  "extracted_data": {
    "numero_factura": "2025-MKT-567",
    "proveedor": "Agencia Creativa Digital",
    "monto_total": 127330000,
    "moneda": "COP"
  },
  "approval": {
    "decision": "manager_review",
    "requires_human_review": true,
    "risk_level": "low"
  }
}
```

### **üé© Executive Review - Credit Note**
**Scenario**: Credit note (always escalates) + high amount
```json
{
  "invoice_id": 5,
  "document_metadata": {
    "type": "credit_note",        // Automatic escalation
    "risk_score": 0.16
  },
  "extracted_data": {
    "numero_factura": "NC-2025-055",
    "proveedor": "Equipos Industriales del Norte",
    "monto_total": 100000000,
    "moneda": "COP"
  },
  "approval": {
    "decision": "executive_review",
    "requires_human_review": true,
    "risk_level": "low"
  }
}
```

### **‚ùå Rejected - Critical Errors**
**Scenario**: Missing critical fields, high risk score
```json
{
  "invoice_id": 30,
  "document_metadata": {
    "type": "email",
    "risk_score": 0.673           // High risk score
  },
  "extracted_data": {
    "numero_factura": "number",   // Invalid extraction
    "proveedor": "",              // Missing vendor
    "monto_total": 0,             // Invalid amount
    "moneda": "COP"
  },
  "validation": {
    "errors": [
      "Proveedor faltante",
      "Monto Total faltante", 
      "Monto inv√°lido o cero"
    ],
    "is_valid": false
  },
  "approval": {
    "decision": "rejected",
    "requires_human_review": true,
    "risk_level": "high"
  },
  "enhanced_risk_analytics": {
    "anomalies_detected": [
      "proveedor faltante",
      "monto total faltante",
      "monto inv√°lido o cero"
    ],
    "compliance_flags": [
      "Anomal√≠as cr√≠ticas detectadas"
    ]
  }
}
```

---

## üîç Enhanced Risk Analytics Section

Every output includes detailed risk analysis:

```json
{
  "enhanced_risk_analytics": {
    "risk_score_breakdown": {
      "validation_errors": 0.25,    // 40% weight - missing fields
      "document_type": 0.20,        // 20% weight - email penalty  
      "amount_threshold": 0.10,     // 20% weight - amount-based
      "data_completeness": 0.33     // 20% weight - incomplete data
    },
    "anomalies_detected": [
      "numero factura faltante"      // Human-readable anomalies
    ],
    "compliance_flags": [
      "Anomal√≠as cr√≠ticas detectadas" // Regulatory flags
    ],
    "document_type_rules_applied": true
  }
}
```

---

## üîó Integration Readiness Flags

Each output includes system-specific integration flags:

```json
{
  "integration_ready": {
    "payment_system": false,      // Can process payment automatically
    "erp_system": true,          // Data quality sufficient for ERP
    "reporting_system": true,    // Always available for reporting
    "compliance_check": true     // Passes compliance requirements
  }
}
```

**Business Logic**:
- **Payment System**: Only `auto_approved` invoices with complete data
- **ERP System**: Requires `validation.is_valid = true`
- **Reporting System**: Always `true` for audit trails
- **Compliance Check**: Risk score < 0.8 and no critical flags

---

## üìã Comprehensive Audit Trail

Every transaction includes complete processing history:

```json
{
  "audit_trail": {
    "api_calls_used": 1,
    "vendor_frequency": 1,         // For future trusted vendor scoring
    "processing_node_path": [       // LangGraph workflow path
      "detect_format",
      "extract_data", 
      "enhanced_validate_risk",
      "intelligent_routing_compliance",
      "generate_enhanced_output"
    ],
    "compliance_version": "2.0",
    "risk_scoring_method": "multifactor_composite",
    "document_type_detected": "formal_invoice",
    "language_detected": "spanish"
  }
}
```

---

## üìä Sample Dataset Results Summary

**From `cobre_enhanced_results_20250917_213113.json` (40 invoices processed)**:

### **Approval Distribution**:
- **Auto-Approved**: 1 invoice (2.5%) - Very conservative approach
- **Supervisor Review**: 8 invoices (20.0%) - Standard workflow
- **Manager Review**: 17 invoices (42.5%) - Higher amounts/complexity  
- **Executive Review**: 11 invoices (27.5%) - Strategic decisions
- **Rejected**: 3 invoices (7.5%) - Critical errors

### **Document Type Breakdown**:
- **Formal Invoices**: 4 (10%) - Standard business documents
- **Emails**: 14 (35%) - Informal invoice delivery
- **JSON**: 19 (47.5%) - Structured data format
- **Credit Notes**: 1 (2.5%) - Return/adjustment documents
- **Unknown**: 2 (5%) - Unclassified formats

### **Risk Score Distribution**:
- **Low Risk (0.0-0.3)**: 37 invoices (92.5%)
- **Medium Risk (0.3-0.6)**: 0 invoices (0%)
- **High Risk (0.6-1.0)**: 3 invoices (7.5%) - Rejected

### **Language Processing**:
- **Spanish**: 15 invoices (37.5%) - Primary market
- **English**: 20 invoices (50%) - International vendors
- **Portuguese**: 0 invoices (0%) - Future market
- **Unknown**: 5 invoices (12.5%) - Requires enhancement

---

## üöÄ Running the System

### **CLI Processing**:
```bash
# Generate similar results
python main.py --file invoices.csv --end 40

# Process subset for testing
python main.py --file invoices.csv --end 5
```

### **Dashboard Analysis**:
```bash
# Launch interactive dashboard
streamlit run streamlit_app.py
```

The dashboard provides:
- Real-time processing metrics
- Interactive approval distribution charts  
- Risk score histogram analysis
- Detailed results table with filtering
- JSON download functionality

---

